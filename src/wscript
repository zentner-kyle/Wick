#! /usr/bin/env python3
# encoding: utf-8

def options(opt):
    pass

def configure(conf):
    pass

def build(bld):
    bld.program (
        source = 'scratch.c',
        target = 'scratch',
        use = 'wick',
        includes = '.',
        rpath = '$ORIGIN',
    )
    
    wick_sources = [
        'walloc.c',
        'warray_wrappers.c',
        'warray_wval.c',
        'wbits.c',
        'wbuiltins.c',
        'wcall.c',
        'wchannel.c',
        'whash.c',
        'wplace.c',
        'wstr.c',
        'wsym.c',
        'wtable_wrappers.c',
        'wtable_wval.c',
        'wtoken.c',
        'wtype.c',
    ] 

    bld.objects(
        source   = 'wvm.c',
        target   = 'wvm_core',
        cflags   = '-fno-gcse' if bld.env['use_no_gcse_for_core'] else '',
        includes = '.',
        )
    
    bld.objects(
        source = wick_sources,
        target = 'wick_objects',
        includes = '.',
    )
    
    bld(
        features = 'c cshlib',
        use    = 'wick_objects wvm_core',
        target = 'wick',
    )

    bld.program(
        source = 'main.c',
        target = 'wick0',
        includes = '.',
        use = 'wick',
        rpath = '$ORIGIN',
    )
